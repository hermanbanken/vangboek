<template name="bills">
  <div class="table-wrap">
      <table class="table table-striped table-hover">
          <thead><tr>
            <th>Datum</th>
            <th>&Delta; Saldo</th>
            <th>Type</th>
            <th>Opmerking</th>
            {{#unless userModel}}<th>{{t 'users'}}</th>{{/unless}}
          </tr></thead>
          <tbody>{{#each this}}
            <tr>
              <td><a href="{{pathFor 'billShow'}}">{{datef date 'll'}}</a></td>
              <td>{{#if userModel}}{{#currency sumFor userModel}}{{/currency}}{{else}}{{currency change}}{{/if}}</td>
              <td>{{type}}</td>
              <td>{{title}}</td>
              {{#unless userModel}}<td>{{#each users}}
                {{stringify this.profile.name}}, 
              {{/each}}</td>{{/unless}}
            </tr>
            {{else}}
            <tr><td colspan="{{#if ../_id}}4{{else}}5{{/if}}" class=cap>{{t 'no entries yet'}}</tr>
          {{/each}}</tbody>
      </table>
  </div>
</template>

<template name="billPage">
  <div class="container">
    <div class="row"><div class="col-sm-12">
      <h2>{{t 'bills'}} <small><a href="{{pathFor 'billNew'}}">{{t 'add new'}}</a></small></h2>
      {{>bills}}
    </div></div>
  </div>
</template>

<template name="bill">
  <div class="container">
    <div class="row"><div class="col-sm-4">
      {{#isolate}}
      <h2>{{t 'bill'}} {{title}}</h2>
      <form role="form">
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" class="form-control" id="date" placeholder="Datum" value="{{datef date 'YYYY-MM-DD'}}" />
        </div>
        <div class="form-group {{#if hasDifficiency}}has-error{{/if}}">
          <label for="change">Change</label>
          <input type="text" class="form-control" id="change" placeholder="Liquidity change" value="{{change}}">
        </div>
        <div class="form-group">
          <label for="note">Note</label>
          <textarea id="note" class="form-control" name="note" rows="3">{{note}}</textarea>
        </div>
        <div class="form-group">
          <label for="type">Type</label>
          <input type="text" class="form-control" id="type" placeholder="Type" value="{{type}}">
        </div>
        <button type="submit" class="btn btn-default">Save</button>
        <a data-action='remove' class="btn btn-danger pull-right">Delete</a>
      </form>
    {{/isolate}}
    </div><div class="col-sm-8">
      {{#eachBranchedBy splits 'name'}}
        {{>changeslist}}
      {{else}}
        <p>{{t 'Er zijn geen splitsingen gedefinieerd'}}</p>
      {{/eachBranchedBy}}
    </div></div>
  </div>
</template>

<template name="changeslist">
  <h2>{{t name}}</h2>
  <ul class='changes changes-type-{{name}}'>
    {{#each list}}
      <li class='change'>{{>change}}</li>
    {{/each}}
    <li class='rel left'>
      <div class='add abs'>
        {{#constant}}<input type="text" name="user" maxlength="20" class="has-typeahead" placeholder="{{t 'Add'}}" data-typeahead="suggest.{{name}}" />{{/constant}}
        {{{suggest 'profile.name' name userCollection}}}
      </div>
    </li>  
  </ul>
  <div class='clear'></div>
</template>

<template name="change">
  <div class='name'>{{user.profile.name}}</div>
  <div class='img'>
    <img src="{{userServiceField user.services 'picture' 'http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536'}}" class='icon-lg' />
    {{#if computed}}
      <a class='btn' data-action="up">+</a><a class='btn' data-action="down">-</a>
      <span class='amount' data-amount="{{amount}}">{{amount}}x</span>
    {{/if}}
  </div>
  <input type="hidden" name="change[{{_id}}].userId" value="{{userId}}" />
  <input type="hidden" name="change[{{_id}}].type" value="{{type}}" />
  <input type="hidden" name="change[{{_id}}].note" value="{{note}}" />
  <input type="text" name="change[{{_id}}].change" value="{{currency change}}" {{#if computed}}readonly="true"{{/if}} />       
</template>

<!-- {{!--<h2>Users</h2>
      {{#each allUsers}}
        <div class='user'>
          <img src="{{userServiceField services 'picture'}}" class='icon-lg img-circle'>
          {{#each changesFor this}}
          <input type="text" name="users[{{../_id}}][].change" value="{{change}}" />
          <input type="text" name="users[{{../_id}}][].note" value="{{note}}" />
          {{/each}}
          <div>{{_id}} - {{profile.name}} - {{selected}} - {{context}}</div>
        </div>
      {{/each}}
      --}}
  
      {{#each users}}
       <span>{{userId}} - {{change}}</span><br>
      {{else}}
      No users yet
      {{/each}} -->